# 拼伞小程序后端技术方案

## 用户登录

登录时存储用户的微信昵称，性别，微信号(作为主键)

## 实时地图页面(‘/’)

- 路由一：我需要伞，点击后发起一个request请求到`www.****.com/ineedumbrella`。
  - 传输的数据：用户的id，用户的昵称，用户的头像
- 路由二：升级我的小伞(我提供伞)，点起后发起一个request请求到`www.****.com/iofferumbrella`
  - 传输的数据：同上

对页面上存在的小伞，点击时可以看到发出该Note的用户的昵称，头像和备注，分别对需要伞和提供伞的触发`给ta提供伞`或`请求ta为我提供伞`两个路由。

- 路由三：给ta提供伞，输入备注，确认后，发送通知给该用户，通知ta有人愿意为ta提供伞，是否接受。
  - 传输的数据：提供伞的用户的昵称、头像以及备注
- 路由四：请求ta为我提供伞，基本同上。

## 我需要伞页面(‘/ineedumbrella’)

### 需要的数据：

- 位置：在地图上点击后返回经纬度坐标，并在地图上该位置渲染小伞图片

- 备注：要去哪里，什么时候去？

- 有效期：5/10分钟，超时后将表单信息删除

确认提交后，将请求信息暂时存储到该用户的状态中，并推送给所有的用户(这应该在前端有api可以发送通知)。

## 升级小伞(‘iofferumbrella’)

### 表单：

- 位置：同上

- 备注：何时何地能帮助同学？

- 有效期：同上

确认提交后，将请求信息暂时存储到该用户的状态中，并推送给所有在线的用户。

## 成功拼伞(‘/successhelp’)

提供伞的用户等级+1，即success_counts加一，根据等级在主页放置小伞时渲染不同的图片

重定向回主页

## 数据库

### 用户模型(Users)

属性

- id(主键)
- 微信号wx
- 昵称username(默认为微信昵称, 暂不提供个人资料修改)
- 性别sex(默认为男)
- 成功帮助他人的次数success_counts(默认为0)
- neednotes(发起过请求伞的通知)
- offernotes(发起过提供伞的通知)

### 需要伞请求(NeedNotes)

- id(主键)

- 发起通知的用户user_id(外键)

- 通知的内容，即用户在发起请求时输入的备注content

- 是否处于活跃状态is_active(默认为True, 拼伞成功后设为False)
- 时间戳timestamp

### 提供伞请求(OfferNotes)

基本同上